---
- name: Restart VM
  azure_rm_virtualmachine:
    client_id: "{{ client_id }}"
    secret: "{{ secret }}"
    subscription_id: "{{ subscription_id }}"
    tenant: "{{ tenant }}"
    resource_group: "{{ resource_group }}"
    name: "{{ item }}"
    restarted: yes
    state: present
  with_items: "{{ vm_name }}"

- debug: var=output
  when: playbook_debug

- assert:
    that: "azure_vm.powerstate in ['starting', 'running']"
